<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Lâ€™Avent magique de lâ€™EDM</title>
<style>
  /* Page */
  body {
    margin: 0;
    font-family: "Segoe UI", system-ui, -apple-system, "Helvetica Neue", Arial;
    background: linear-gradient(#b30000,#600000);
    color: #fff;
    text-align: center;
  }
  h1 { margin: 20px 0; font-size: 2rem; }
  footer { margin: 10px 0; color: rgba(255,255,255,.85); }

  /* Grille */
  #calendar {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 12px;
    max-width: 1000px;
    margin: 0 auto;
    padding: 18px;
    position: relative;
    z-index: 1;
  }

  /* Case */
  .door {
    position: relative;
    perspective: 900px;
    height: 120px;
    border-radius: 10px;
    cursor: pointer;
    overflow: visible;
    transform-style: preserve-3d;
  }
  .front, .back {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    border-radius: 10px;
    backface-visibility: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 8px;
    box-sizing: border-box;
    transition: transform .6s ease, box-shadow .4s ease;
  }
  .front {
    background: #fff;
    color: #900;
    transform: rotateY(0deg);
  }
  .back {
    background: #ffeedd;
    color: #900;
    transform: rotateY(180deg);
    text-align: center;
    padding: 12px;
  }
  .door.open {
    transform: rotateY(180deg);
    animation: sparkle 1.6s infinite;
  }

  /* hover illumination */
  .door:hover .front { box-shadow: 0 0 16px 6px rgba(255,215,0,0.7); transform: scale(1.03); }

  /* sparkle */
  @keyframes sparkle {
    0% { box-shadow: 0 0 6px 2px gold; }
    50% { box-shadow: 0 0 22px 6px #ffd700; }
    100% { box-shadow: 0 0 6px 2px gold; }
  }

  /* Canvas snow under everything */
  canvas.snow {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 0;
  }

  /* keep calendar and header on top of canvas */
  #calendar, h1, footer { position: relative; z-index: 2; }

  /* small screen: reduce size */
  @media (max-width:700px) {
    #calendar { grid-template-columns: repeat(4, 1fr); padding: 12px; }
    .door { height: 100px; }
  }
  @media (max-width:420px) {
    #calendar { grid-template-columns: repeat(3, 1fr); gap:8px; }
    .door { height: 90px; }
    h1 { font-size:1.4rem; }
  }
</style>
</head>
<body>
  <h1>ðŸŽ„ Lâ€™Avent magique de lâ€™EDM</h1>
  <div id="calendar" aria-live="polite"></div>
  <footer id="page-footer">Calendrier de lâ€™Avent â€” EDM</footer>

  <!-- musique douce (si navigateur bloque autoplay, un bouton apparaÃ®tra) -->
  <audio id="bgmusic" loop>
    <source src="https://cdn.pixabay.com/audio/2022/11/25/audio_6f3165f278.mp3" type="audio/mpeg">
  </audio>

  <!-- neige -->
  <canvas class="snow"></canvas>

<script>
/* ================= CONFIG ================= */
// TEST_MODE : mettre false pour production (dÃ©ploiement). Ici false par dÃ©faut.
const TEST_MODE = false;    // true = simulateur (utile en local pour tester)
const TEST_DAY  = 5;        // jour simulÃ© si TEST_MODE = true (1..24)
const ADMIN_KEY = "edm2024"; // clÃ© admin pour tests / dÃ©pannage

/* ================ DONNÃ‰ES ================ */
const noms = [
  "Annie-Claude","Anne-Laure","Brigitte","Denise","Elise","Emmanuelle",
  "Fatima","Guillemette","Julie","Karima","Laure","LoÃ¯c",
  "Marc","Michelle","Murielle","Nathalie","Nicole","Pascale",
  "Roxane","Sidonie","Sylvie","ValÃ©rie","EDM"
];
const messages = [
  "Laisse ton Ã©nergie positive briller autour de toi",
  "Envoie un message positif sur le Teams de lâ€™Ã©quipe",
  "Chapeau ! Pour la maniÃ¨re dont tu as abordÃ© cette mission complexe quâ€™est le CPF",
  "Pause bien-Ãªtre â€“ Ã©tire-toi, respire, profite du moment",
  "Tu inspires confiance par ton attitude posÃ©e et professionnelle",
  "Ton expertise est prÃ©cieuse et ta collaboration Ã©galement",
  "Aujourdâ€™hui, je te souhaite un sourire qui dure toute la journÃ©e",
  "Ton super pouvoir du jour, faire rire quelquâ€™un",
  "Laisse un post-it positif sur un Ã©cran",
  "Prends soin de toi aujourdâ€™hui ðŸŽ…",
  "Nous te remercions sincÃ¨rement pour ta collaboration",
  "Bienvenue Ã  lâ€™Ã©cole des mÃ©tiers",
  "Ton sens de lâ€™analyse est un vrai atout pour notre Ã©quipe",
  "Tu fais preuve dâ€™une belle curiositÃ© intellectuelle",
  "Tu es toujours prÃªte Ã  donner un coup de main Ã  tes collÃ¨gues",
  "Tu es toujours attentive aux autres. Merci pour ta bienveillance",
  "Tu ne tâ€™ennuies jamais",
  "Gardez le sourire, le meilleur reste Ã  venir",
  "Dis-nous 3 choses qui rendent heureuse",
  "Tes efforts dâ€™aujourdâ€™hui sont les rÃ©ussites de demain",
  "Merci pour lâ€™Ã©nergie et le bien-Ãªtre que tu transmets aux agents",
  "Ta capacitÃ© Ã  rÃ©soudre des problÃ¨mes complexes est admirable",
  "EDM : Joyeux NoÃ«l Ã  toute lâ€™Ã©quipe. Merci pour votre solidaritÃ© ðŸŽ„"
];

/* ================ Date handling ================ */
let today = new Date();
if (TEST_MODE) {
  // create a clean date for December TEST_DAY (reliable across browsers)
  today = new Date(new Date().getFullYear(), 11, TEST_DAY);
}
const currentMonth = today.getMonth(); // 0=Jan ... 11=Dec
const currentDay = today.getDate();

/* ================ Snow (canvas) ================ */
const canvas = document.querySelector('canvas.snow');
const ctx = canvas.getContext('2d');

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

let baseFlakeCount = 100;
let flakes = [];

function createFlakes(n) {
  flakes = Array.from({length: n}, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random() * 3 + 1,
    d: Math.random() + 0.5
  }));
}
createFlakes(baseFlakeCount);

function drawSnow() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = 'white';
  ctx.beginPath();
  for (const f of flakes) {
    ctx.moveTo(f.x, f.y);
    ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
  }
  ctx.fill();
  // move
  for (const f of flakes) {
    f.y += Math.pow(f.d, 2) + 0.8;
    if (f.y > canvas.height) { f.y = -10; f.x = Math.random() * canvas.width; }
  }
  requestAnimationFrame(drawSnow);
}
drawSnow();

/* ================ Calendar generation ================ */
const cal = document.getElementById('calendar');

// safety: ensure arrays same length
const N = Math.min(noms.length, messages.length);

for (let i = 0; i < N; i++) {
  const dayNumber = i + 1;
  const door = document.createElement('div');
  door.className = 'door';
  door.innerHTML = `
    <div class="front"><strong>${dayNumber}</strong><br>${noms[i]}</div>
    <div class="back">${messages[i]}</div>
  `;

  door.addEventListener('click', () => {
    // Before December -> block
    if (currentMonth < 11) {
      alert('ðŸŽ Patience ! Le calendrier dÃ©bute le 1er dÃ©cembre.');
      return;
    }
    // Future day -> block
    if (dayNumber > currentDay) {
      alert('ðŸŽ Patience ! Ce nâ€™est pas encore ton jour.');
      return;
    }

    // Ask for name or admin
    const saisie = prompt('ðŸ” Entrez votre prÃ©nom pour ouvrir la case (ou la clÃ© admin) :');
    if (!saisie) return;
    const txt = saisie.trim().toLowerCase();
    const nomOk = txt === (noms[i] || '').toLowerCase();
    const adminOk = txt === ADMIN_KEY.toLowerCase();

    if (!nomOk && !adminOk) {
      alert('â›” DÃ©solÃ©, cette case ne tâ€™est pas destinÃ©e !');
      return;
    }

    // If correct:
    if (dayNumber === currentDay) {
      // toggle open for day J
      door.classList.toggle('open');
      // intensify snow briefly
      createFlakes(baseFlakeCount * 2);
      setTimeout(() => createFlakes(baseFlakeCount), 3000);
      return;
    } else {
      // past day: show message in alert (or you can toggle open if you prefer)
      alert(`(${dayNumber} dÃ©cembre) ${messages[i]}`);
    }
  });

  cal.appendChild(door);
}

/* ================ Music autoplay helper ================ */
document.addEventListener('DOMContentLoaded', () => {
  const audio = document.getElementById('bgmusic');
  audio.play().catch(() => {
    // show small play button if autoplay blocked
    const btn = document.createElement('button');
    btn.textContent = 'â–¶ Lancer la musique';
    Object.assign(btn.style, {
      position: 'fixed', top: '10px', right: '10px', zIndex: 3,
      padding: '8px 12px', background: '#c0392b', color: '#fff',
      border: 'none', borderRadius: '6px', cursor: 'pointer'
    });
    btn.addEventListener('click', () => { audio.play(); btn.remove(); });
    document.body.appendChild(btn);
  });
});
</script>
</body>
</html>
